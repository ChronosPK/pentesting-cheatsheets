## https://github.com/ChronosPK/pentesting-cheatsheets
<br>


--------------------------------------------------
21/TCP - FTP
--------------------------------------------------
### enum
```bash
nmap --script=*ftp* -p21 $IP -oN recon/nmap.ftp
```
### bruteforce
```bash
hydra -I -V -F -t 64 -L users.txt -P /usr/share/wordlists/rockyou.txt ftp://$IP 
```
### other
```
extract all files, check write permissions, `quote PASSV` for passive sessions, mod_copy - RCE vsftpd 1.3.5, LFI2RCE
```


--------------------------------------------------
22/TCP - SSH
--------------------------------------------------
### enumeration
```bash
nmap -p22 $IP -sV
# weak keys
nmap -p22 $IP--script ssh-hostkey --script-args ssh_hostkey=full -oN recon/nmap.ssh_weak_keys
```
### bruteforce username/password
```bash
hydra -l user -P /usr/share/wordlists/password/rockyou.txt -e s ssh://$IP -s 22
```
### simple access
```bash
ssh user@$IP
# execute command right after connect
ssh -v user@$IP id;cat /etc/passwd
```
### access - id_rsa key 
```bash
chmod 600 id_rsa
ssh -i id_rsa $user@$IP
```
### access - SSH tunnel
```bash
# local
ssh -L $local_IP:$local_port:destination_IP:$destination_port user@$SSH_server
# remote
ssh -R $remote_IP:$remote_port:destination_IP:$destination_port user@$SSH_server
```
### other
```
# port knock, SSH log poisoning, backdoor persistence
```


--------------------------------------------------
23/TCP - TELNET
--------------------------------------------------
### enumeration
```bash
nmap -n -sV -Pn --script "*telnet* and safe" -p 23 $IP -oN recon/nmap.telnet
```
### bruteforce
```bash
hydra -l root -P /usr/share/seclists/Passwords/xato-net-10-million-passwords-10000.txt $IP telnet
```


--------------------------------------------------
25,465,587/TCP - SMTP
--------------------------------------------------
### enumeration
```bash
# enumerate users
nmap --script smtp-enum-users $IP -oN recon/nmap.smtp_users
# allowed commands
nmap -p25 --script smtp-commands $IP -oN recon/nmap.smtp_comm
```
### other
```
# MX servers, NTLM auth is enabled (Windows), mail from a user
```


--------------------------------------------------
53/TCP,UDP - DNS
--------------------------------------------------
### enumeration
```
# nmap general
nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" $IP -oN recon/nmap.dns
# DNS records
dig $domain +short # A records
dig $domain -t mx +short # MAIL records
dig $domain -t ns +short # NS, CNAME
```
### other
```
# TCP -> zone transfer - get subdomains
dig axfr domain.com @10.10.10.10
```



--------------------------------------------------
80,443/TCP - HTTP,HTTPS
--------------------------------------------------
### Fuzz files and directories
```bash
# files
wfuzz -c -z file,/usr/share/seclists/Discovery/Web-Content/raft-medium-files.txt --hc 404 -f recon/wfuzz-files.out "$URL/FUZZ" 
feroxbuster --url $URL -e -x .php,txt,html -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -o recon/ferox.out

# directories
wfuzz -c -z file,/usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt --hc 404 -f recon/wfuzz-dirs.out "$URL/FUZZ/"
ffuf -c -u $URL/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -o recon/ffuf.md
dirb $URL /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -o recon/dirb.out
dirbuster -r recon/dirbuster.out #GUI
gobuster dir -u $URL -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 100 -o recon/gobuster.out

# change request method
ffuf -c -t 200 -fs 50,182 -u "$URL/FUZZ/" -w /usr/share/wordlists/dirb/big.txt -o recon/ffuf-post_method.md -X POST
```
### FUZZ file extensions
```bash
ffuf -u $URL/indexFUZZ -w /usr/share/seclists/Discovery/Web-Content/web-extensions.txt -o recon/ffuf-ext.md
ffuf -c -u $URL/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-words-lowercase.txt -e .sh,.cgi,.pl,.py -fc 404 -o recon/ffuf-extensions.md
```
### FUZZ parameters
```bash
# don't forget to include LFI or RFI statements
ffuf -u "$URL/?FUZZ=1" -c -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -fw 39
for i in {0..255}; do echo $i; done | ffuf -u '$URL?id=FUZZ' -c -w - -fw 33 -o recon/sequence.md
```
### bruteforce login
```bash
wfuzz -c -z file,users.txt -z file,pass.txt -d "name=FUZZ&password=FUZ2Z" --sc 200 --hh 206 $URL/login.php
# check type: GET or POST request 
hydra -I -V -F -l admin -P /usr/share/wordlists/rockyou.txt $IP http-post-form "/login.php:username=admin&password=^PASS^:Invalid Password:H=Cookie: PHPSESSID=cd892e2HNW3N"
```
### subdomain bruteforce
```bash
wfuzz -c -f subdomains.txt -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt --hl 7 -u "$domain" -H "Host: FUZZ.$domain"
gobuster vhost -u $URL -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
```
### vulnerability scanners
```bash
nikto --host $URL -C all -o recon/nikto.txt 
whatweb -a 4 $URL
```
### CMS scanners
```bash
# WordPress
wpscan --url $URL --disable-tls-checks --force update --enumerate u,t,p # -o recon/wpscan.out
wpscan --url $URL --password-attack wp-login -U userlist -P passlist # --max-threads 50
# Drupal
droopescan scan drupal -u $domain
# Joomla
joomscan --ec -u $URL
```
### Other
```plain
domain name -> check subdomains
https -> certificate -> mails, usernames, subdomains
cookies (oracle padding attack?)
robots.txt
.git, .secret, .bak, .cgi
allowed HTTP verbs
header "X-HTTP-Method-Override: PUT" can overwrite the verb used
php files? check php5, phar extensions
application uses a linux tool? injection!
```

--------------------------------------------------
88 - Kerberos
--------------------------------------------------
### enumerate users
```bash
# metasploit
msfconsole -q -c 'use auxiliary/gather/kerberos_enumusers \
set rhosts $IP \
set user_file /usr/share/seclists/Usernames/top-usernames-shortlist.txt \
set domain $domain \
run'
# nmap 
nmap -p 88 --script=krb5-enum-users --script-args krb5-enum-users.realm="$domain",userdb=/path/to/userlist $IP -oN recon/nmap.kerberos_enum_u
```
### bruteforce password with usernames
```bash
kerbrute -domain $domain -users users.txt -passwords passwords.txt -outputfile recon/kerbrute.out
```
### other
```
harvest the non-preauth AS_REP responses, (with creds) list of user service principal names
```


--------------------------------------------------
110,995/TCP - POP3,POP3S
--------------------------------------------------
### banner grabbing
```bash
nc -nv $IP 110
```
### NTLM info disclosure
```bash
nmap -p 110,995 --script pop3-ntlm-info $IP -oN recon/nmap.pop3-ntlm
```
### (with creds) login
```
telnet $IP 110
>  user $username
>  pass $password
```
### capabilities
```bash
nmap -p 110,995 --script pop3-capabilities $IP -oN recon/nmap.pop3-cap
```

--------------------------------------------------
111/TCP,UDP - RPCbind
--------------------------------------------------
### enumerate services
```bash
rpcinfo $IP
```


--------------------------------------------------
135,593/TCP - MSRPC
--------------------------------------------------
### nmap enum
```bash
nmap -sV -script msrpc-enum -Pn $IP -oN recon/nmap.msrpc
```
### dump RPC endpoints
```bash
impacket-rpcdump $IP
```
### dump info from SAMR
```bash
impacket-samrdump $IP
```
### query info on MS-RPC client side
```bash
rpcclient -U "" -N $IP
rpcclient -U user%domain@$IP
rpcclient //$IP -U $domain/user%$hash --pw-nt-hash
```


--------------------------------------------------
137/UDP,TCP, 138/UDP, 139/TCP - NetBios
--------------------------------------------------
### get the server name
```bash
sudo nmap -sU -sV -T4 --script nbstat.nse -p137 -Pn -n $IP -oN recon/nmap.nbtstat
nmblookup -A $IP
nbtscan -v $IP
# for windows
nbstat -A $IP
```


--------------------------------------------------
139,445/TCP - NetBIOS, SMB
--------------------------------------------------
### enumeration
```bash
# general
enum4linux -avA $IP -u user -p pass > recon/enum_4_linux
# check vulns
nmap --script smb-vuln* -p 139,445 $IP -oN recon/nmap.smb_vuln
```
### list shares
```bash
nmap --script "safe or smb-enum-*" -p 139,445 $IP -oN recon/nmap.smb_enum
smbmap -H return.local -u svc-printer -p "1edFg43012\!\!" -r
```
### analyze shares
```bash
smbclient -N -L \\\\$IP
smbclient -U 'user%passwd' -L //$IP
# download files recursively
smbclient '\\\\$IP\\share' -N -c 'prompt OFF ; recurse ON ; cd 'where\from' ; lcd 'where/to' ; mget *'
```
### auth bruteforce
```bash
hydra -L user.txt -P pass.txt $IP smb
crackmapexec smb $IP -u users.txt -p passwords.txt
```


--------------------------------------------------
143,993/TCP - IMAP,IMAPS
--------------------------------------------------
### banner grabbing
```bash
nc -nv $IP 143
openssl s_client -connect $IP:993 -quiet
```
### GUI mail application
```bash
thunderbird ; evolution
```
### auth bruteforce
```bash
hydra -I -V -F -l user -P /usr/share/wordlists/rockyou.txt $IP imap 
nmap -sV --script imap-brute -p $port $IP -oN recon/nmap.imap_brute
```
### other
```
# navigate (nc and curl) - login, list files and messages, NTLM auth - information disclosure
```


--------------------------------------------------
389,636,3268,3269/TCP - LDAP (+tcpwrapped)
--------------------------------------------------
### enumeration
```bash
nmap -n -sV --script "ldap* and not brute" $IP -oN recon/nmap.ldap
```
### LDAP
```bash
# null creds auth
ldapsearch -x -H ldap://$IP -D '' -w '' -b "DC=domain,DC=name"
# creds auth
ldapsearch -x -H ldap://$IP -D '$domain\user' -w 'password' -b "CN=Remote Desktop Users,CN=Builtin,DC=domain,DC=name"
# extract info
ldapsearch -x -H ldaps://$IP:636/ -s base -b '' "(objectClass=*)" "*" +
# check for admin pass
ldapsearch -x -H ldap://$IP -D '$domain\user' -w 'password' -b "dc=domain,dc=name" "(ms-MCS-AdmPwd=*)" ms-MCS-AdmPwd
```


--------------------------------------------------
2049/TCP - NFS
--------------------------------------------------
### enumeration
```bash
nmap -p 111 --script=nfs-ls,nfs-statfs,nfs-showmount $IP -oN recon/nmap.nfs
```
### list shares
```bash
showmount -e $IP
nmap --script "nfs-ls, nfs-showmount, nfs-statfs" $IP
```
### mount and unmount shares
```bash
# mount
sudo mkdir /mnt/local_share
mount -t nfs -o vers=3 192.168.2.4:/remote/share /mnt/local_share
# unmount
sudo umount /mnt/local_share
```
### other
```
# mount files (careful with unmounting), check config files
```


--------------------------------------------------
3306/TCP - MySQL
--------------------------------------------------
### enumeration
```bash
nmap -sV -Pn -T4 -vv -script=mysql-brute $IP -p 3306 -oN nmap/mysql-brute
find / -type f -name wp-config.php 2>/dev/null
```
### login
```bash
mysql -u'root' -p'root' -h $IP -d database 
```
### other
```
# interogate database, check specific files for credentials
```


--------------------------------------------------
3389/TCP - RDP
--------------------------------------------------
### connect with creds
```bash
xfreerdp /u:username /p:password /v:$IP /f +clipboard # /d:domain /cert:ignore
rdesktop $IP -d $domain -u $username -p '$password'
remmina -c rdp://user@$IP
```
### bruteforce login
```bash
hydra -L users -p '$password' $IP rdp
```
### check credentials
```bash
rdp_check $domain/$username:$password@$IP
```
### other
```
# connect with no creds, allow RDP from windows host, create hidden user, meterpreter shell, persistence - sticky keys, mimikatz
```
